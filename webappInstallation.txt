#patanzer
#How to install Massmine-for-the-Masses

GET YOURSELF A VM
	1. Install an Ubuntu VM - 18.04 tested. There's guides for this everywhere, please don't ask us.

BASIC TOOLS TO INSTALL THE REST OF IT
	2. Install git: sudo apt-get install git
	3. Install pip: sudo apt install python3-pip

SETTING UP YOUR VIRTUAL ENVIRONMENT
	4. Install virtualenv: python3 -m pip install virtualenv
	5. Make a working directory: mkdir django
	6. Go into working directoy: cd django
	7. Create virtual enviornment: python3 -m virtualenv environ -p python3
	8. Activate environment: source environ/bin/activate

WHAT TO INSTALL IN YOUR ENVIRONMENT
	9.  Install django: pip install django
	10. Install numpy: pip install numpy
	11. Install matplotlib: pip install matplotlib
	12. Install plotly: pip install plotly
	13. Install cufflinks: pip install cufflinks
	14. Install pandas: pip install pandas
	NEW: 15. Install celery for async support: pip install celery
	NEW: 16. Install erlang: apt-get install -y erlang
	NEW: 17. Install rabbitmq-server sudo apt-get install rabbitmq-server
	NEW: 18. Install django celery backend: pip install django-celery-results 
	NEW: 19.  pip install django-encrypted-model-fields
	NEW: 20. sudo apt-get install expect

REPOSITORY CODE INSTALLATION
	21. Get back out and clone the repository: cd && git clone https://github.com/JoshCMoore/Massmine-for-the-Masses.git
	22. Get into cloned directory: cd Massmine-for-the-Masses
	23. (Developers only) Checkout the right branch (for example, I do: git checkout patanzer)
	24. Get back out to your home directory: cd  
	25. Copy webappproject folder into your virtual environment:
	You want to get the 'webapp' folder from Massmine-for-the-Masses/src and put it into the django directory you just created. 
	You can use a file manager, or else do the following command: cp -a Massmine-for-the-Masses/src/. django/

INSTALING MASSMINE
	For your convenience, Massmine 1.1.0 is included in the webapp folder so you don't have to go download it. The website for it is here: https://www.massmine.org/
	26: Unzip the Massmine zip file: unzip django/webapp/massmine-1.1.0-linux-x86_64 -d django/
	27. Make massmine executable (may ask for your password): cd django && sudo ln -s `pwd`/massmine/massmine /usr/local/bin
	

MAKING YOUR ENCRYPTION KEYFIXING TIMEZONE ERROR AND OTHER ENVIRONMENT ISSUES
	28. Replace problem variable: cd && sed -i "s/TIME_ZONE/TIME/g" django/environ/lib/python3.6/site-packages/django/utils/timezone.py
	29. (Ignore for development) Remove any old keys: sed -i '/FIELD_ENCRYPTION_KEY/d' django/webapp/webappproject/settings.py
	30. (Ignore for development)Insert a dummy key to use while generating a new one: echo "FIELD_ENCRYPTION_KEY = '6-QgONW6TUl5rt4Xq8u-wBwPcb15sIYS2CN6d69zueM='" >> django/webapp/webappproject/settings.py
	31. (Ignore for development)Add variable to activate script so it stays around: MYVAR=$( python django/webapp/manage.py generate_encryption_key) && echo "export FIELD_ENCRYPTION_KEY=$MYVAR" >> django/environ/bin/activate
	32. (Ignore for development)Update settings.py to use the new key: sed -i '/FIELD_ENCRYPTION_KEY/d' django/webapp/webappproject/settings.py && echo "FIELD_ENCRYPTION_KEY = '$MYVAR'" >> django/webapp/webappproject/settings.py
	# Originally the line in settings should have read: FIELD_ENCRYPTION_KEY = os.environ.get(‘FIELD_ENCRYPTION_KEY’, ‘’), 
	# However, due to errors in testing, we keep the hardcoded value instead. 
	# As a result, it is HIGHlY advised you strip this key from your settings before uploading to a public repository.


CREATING DATABASE
	33. python django/webapp/manage.py makemigrations
	34. python django/webapp/manage.py migrate --run-syncdb
	35. python django/webapp/manage.py migrate django_celery_results
	OPTIONAL: if you want an admin, do: python django/webapp/manage.py createsuperuser and walk through the options to create one

STARTING THE SERVER
	36. Run your server!: python django/webapp/manage.py runserver



You're done! If you close this environment, you can get back into it by cd'ing into the django folder and running: source environ/bin/activate

If you want to have forgot password send to actual emails, you will need to either set up a smtp server or use a third party service and change details in the webapp/webappprojct/settings.py file. Currently, emails are 'sent' to a folder within the project.

Note to developers: Functionality may need to be introduced that will start massmine and the rabbitmq-server automatically
